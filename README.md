# crewman-daniels
Build status: [![build status](https://travis-ci.org/rnowling/crewman-daniels.svg?branch=master)](https://travis-ci.org/rnowling/crewman-daniels)

[Crewman Daniels](http://memory-alpha.wikia.com/wiki/Daniels_(Crewman)) is a character from [Star Trek: Enterprise](https://en.wikipedia.org/wiki/Star_Trek:_Enterprise) who travels or transports the crew to various points in time to assist them.

<img src="https://vignette.wikia.nocookie.net/memoryalpha/images/8/89/Daniels2.jpg/revision/latest?cb=20100806165630&path-prefix=en" width="100px" height="120px">

Similary, `crewman-daniels` is a set of tools that help with analyzing the timeseries data generated by molecular dynamics simulations. Many of these tools build on excellent libraries maintained by others in the field.

## Dependencies

* [MDTraj](http://mdtraj.org)
* [Scikit-learn](http://scikit-learn.org/stable/)
* [MSMBuilder](http://msmbuilder.org)
* [NetworkX](https://networkx.github.io/)
* Numpy/Scipy/Matplotlib
* Seaborn

## Running Tests
To run the included tests, you will need to download the test data set (2 us of Ala5 simulation data).  The included `Makefile` can download the data and run the tests for you.

```bash
$ make test
```

Note that you will need to have the Git [Large File Storage](https://git-lfs.github.com/) plugin installed to download the data.  To run the tests, you will need to have [bats](https://github.com/sstephenson/bats) installed.

## Tools

### Strip Water and PBC
Many of the tools in Crewman Daniels were originally written for implicit-solvent simulations.  As a consequence, they do not properly handle periodic boundary conditions (PBC).  As a consequence, to apply the tools to explicit solvent simulations, we need to strip the waters and center the protein within the box.  We provide a script to help with this:

```bash
$ ./bin/strip-water-pbc \
    --input-pdb <pdb-file> \
    --input-traj <dcd-file> \
    --output-pdb <pdb-file> \
    --output-traj <dcd-file>
```

### Root-Mean-Square Deviation (RMSD)
RMSD can be calculated using the `rmsd` script:

```bash
$ ./bin/rmsd \
    --timestep <timestep-in-ns> \
    --pdb-file <pdb-file> \
    --input-traj <dcd-file> \
    --figure-fl <rmsd.png> \
    --output-tsv <rmsd.tsv>
```

The script supports specifying keywords `all`, `heavy`, `minimal`, `alpha`, and `water` for atom groups or a valid MDTraj [atom select expression](http://mdtraj.org/1.9.0/atom_selection.html).

### Component Analysis
The `component-analysis` module performs feature extraction, dimensionality reduction, and facilitates analysis of the resulting components. Supported dimensionality reduction (decomposition) methods include [PCA](http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html), [SVD](http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.TruncatedSVD.html), [ICA](http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.FastICA.html), and [tICA](http://msmbuilder.org/3.8.0/decomposition.html#tica). If deciding between the methods, tICA performed on `transformed-dihedrals` (sine and cosines of dihedral phi and psi angles) is most likely best suited for your needs.

```bash
$ ./bin/component-analysis \
    train-model \
    --n-components <n-components> \
    --pdb-file <pdb-file> \
    --input-traj <dcd-file> \
    --model-file <trained-model> \
    --feature-type <feature-type> \
    --lag-time <lag-time>
```

Supported analyses include explained variance ratios (PCA), timescales (tICA), heatmap of projections (all methods), and timeseries of projected coordinates (all methods).
